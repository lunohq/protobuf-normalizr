!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports["protobuf-normalizr"]=e():n["protobuf-normalizr"]=e()}(this,function(){return function(n){function e(r){if(t[r])return t[r].exports;var a=t[r]={exports:{},id:r,loaded:!1};return n[r].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e){"use strict";function t(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],t={},r={},a=d(n,t,r,e);return{entities:t,normalizations:r,result:a}}function r(n,e,t){var r=o(e);if(t.entities[r]){if(Array.isArray(n))return n.map(function(n){var e=t.entities[r][n];return p(e,r,n,t),e});var a=t.entities[r][n];return p(a,r,n,t)}}function a(n,e,t,r){var a=o(t);if(r.normalizations[a]){var u=r.normalizations[a][e];if(u)return u[n]}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=t,e.denormalize=r,e.getNormalizations=a;var u=function(n){return n&&n.$type},i=function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n&&n.hasOwnProperty("id")&&null!==n.id||null!==e?!0:!1},o=function(n){return n.$type.fqn().toLowerCase()},s=function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return e?e:n.get("id")},l=function(n,e,t,r){var a=arguments.length<=4||void 0===arguments[4]?null:arguments[4],u=e.get(n.name);if(null!==u&&(n.repeated&&u.length||i(u,a))){var l=o(e),f=s(e,a);r[l]||(r[l]={}),r[l][f]||(r[l][f]={});var m=r[l][f];n.repeated?(m[n.name]||(m[n.name]=[]),u.map(function(e){m[n.name].push(e.id),d(e,t,r)}),e.set(n.name,null)):i(u)&&(m[n.name]=u.id,d(u,t,r),e.set(n.name,null))}},f=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3];return n.$type._fields.map(function(a){l(a,n,e,t,r)}),n},m=function(n,e,t){var r=n.map(function(n){return d(n,e,t)});return r},c=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],a=o(n),u=s(n,r);return e[a]||(e[a]={}),e[a][u]=n,f(n,e,t,r),u},d=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3];return u(n)&&i(n,r)?c(n,e,t,r):u(n)?f(n,e,t):n instanceof Array?m(n,e,t):n},p=function v(n,e,t,r){var a=n.$type.clazz.decode(n.encode());if(!r.normalizations[e])return a;var u=a.$type._fieldsByName,i=r.normalizations[e][t],o=function(n){var e=i[n],t=u[n].resolvedType.fqn().toLowerCase();if(e instanceof Array)a.set(n,[]),e.map(function(e){var u=r.entities[t][e];a[n].push(v(u,t,e,r))});else{var o=r.entities[t][e];a.set(n,v(o,t,e,r))}};for(var s in i)o(s);return a}}])});
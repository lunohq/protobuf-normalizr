!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["protobuf-normalizr"]=e():n["protobuf-normalizr"]=e()}(this,function(){return function(n){function e(r){if(t[r])return t[r].exports;var u=t[r]={exports:{},id:r,loaded:!1};return n[r].call(u.exports,u,u.exports,e),u.loaded=!0,u.exports}var t={};return e.m=n,e.c=t,e.p="",e(0)}([function(n,e){"use strict";function t(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1],t=arguments.length<=2||void 0===arguments[2]?null:arguments[2],r={},u={},a=v(n,r,u,e,t);return{entities:r,normalizations:u,result:a}}function r(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],u=o(e);if(t.entities[u]){if(!Array.isArray(n)){var a=t.entities[u][n];return d(a,u,n,t,void 0,r)}var i=function(){var e=!0,a=[];return n.every(function(n){var i=t.entities[u][n],o=d(i,u,n,t,void 0,r);return r&&(e=r(o,u,n)),e&&a.push(o),e}),e?{v:a}:{v:null}}();return"object"==typeof i?i.v:void 0}}function u(n,e,t,r){var u=o(t);if(r.normalizations[u]){var a=r.normalizations[u][e];if(a)return a[n]}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=t,e.denormalize=r,e.getNormalizations=u;var a=function(n){return n&&n.$type},i=function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return n&&n.hasOwnProperty("id")&&null!==n.id||null!==e?!0:!1},o=function(n){return n.$type.fqn().toLowerCase()},s=function(n){var e=arguments.length<=1||void 0===arguments[1]?null:arguments[1];return e?e:n.get("id")},l=function(n,e,t,r){var u=arguments.length<=4||void 0===arguments[4]?null:arguments[4],a=arguments.length<=5||void 0===arguments[5]?null:arguments[5],l=e.get(n.name);if(null!==l&&(n.repeated&&l.length&&i(l[0],u)||i(l,u))){var m=o(e),g=s(e,u);r[m]||(r[m]={}),r[m][g]||(r[m][g]={});var f=r[m][g];n.repeated?(f[n.name]||(f[n.name]=[]),l.map(function(e){f[n.name].push(e.id),v(e,t,r,a)}),e.set(n.name,null)):i(l)&&(f[n.name]=l.id,v(l,t,r,a),e.set(n.name,null))}},m=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3];return n.$type._fields.map(function(u){l(u,n,e,t,r)}),n},g=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],u=n.map(function(n){return v(n,e,t,r)});return u},f=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],u=arguments.length<=4||void 0===arguments[4]?null:arguments[4],a=o(n),i=s(n,r);return e[a]||(e[a]={}),u?e[a][i]=u(e[a][i],n):e[a][i]=n,m(n,e,t,r),i},v=function(n,e,t){var r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],u=arguments.length<=4||void 0===arguments[4]?null:arguments[4];return a(n)&&i(n,r)?f(n,e,t,r,u):a(n)?m(n,e,t,u):n instanceof Array?g(n,e,t,u):n},d=function c(n,e,t,r){var u=arguments.length<=4||void 0===arguments[4]?null:arguments[4],a=arguments.length<=5||void 0===arguments[5]?null:arguments[5],i=n.$type.clazz.decode(n.encode());if(!r.normalizations[e])return i;var o=i.$type._fieldsByName,s=r.normalizations[e][t],l=function(n){var t=s[n],a=o[n].resolvedType.fqn().toLowerCase();if(a===u)return"continue";if(t instanceof Array)i.set(n,[]),t.map(function(t){var o=r.entities[a][t];i[n].push(c(o,a,t,r,u=e))});else{var l=r.entities[a][t];i.set(n,c(l,a,t,r,u=e))}};for(var m in s){l(m)}return a&&!a(i,e,t)?null:i}}])});